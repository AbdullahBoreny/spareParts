<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:spareParts.Converters"
             x:Class="spareParts.PageViews.Customer.HomePage"
             Title="Home">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:BoolToStatusConverter x:Key="BoolToStatusConverter" />
            <converters:InvertBoolConverter x:Key="InvertBoolConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Spacing="20" Padding="20">
            <!-- Header -->
            <VerticalStackLayout Spacing="10" Margin="0,20,0,30">
                <Label Text="Welcome to SpareParts" 
                       FontSize="28" 
                       FontAttributes="Bold" 
                       HorizontalOptions="Center" 
                       TextColor="#2C3E50" />
                
                <Label Text="Discover shops selling spare parts near you" 
                       FontSize="16" 
                       HorizontalOptions="Center" 
                       TextColor="Gray" />
            </VerticalStackLayout>
            
            <!-- Authentication Section - Show when NOT authenticated -->
            <StackLayout x:Name="AuthenticationSection">
                <StackLayout Orientation="Horizontal" 
                             HorizontalOptions="Center" 
                             Spacing="15"
                             Margin="0,0,0,20">
                    <Button Text="Login" 
                            BackgroundColor="#3498DB" 
                            TextColor="White" 
                            CornerRadius="8" 
                            HeightRequest="40" 
                            WidthRequest="100"
                            x:Name="LoginButton" />
                    <Button Text="Sign Up" 
                            BackgroundColor="#27AE60" 
                            TextColor="White" 
                            CornerRadius="8" 
                            HeightRequest="40" 
                            WidthRequest="100"
                            x:Name="SignupButton" />
                </StackLayout>
                
                <!-- Message for unauthenticated users -->
                <Frame BackgroundColor="#F8F9FA" 
                       CornerRadius="10" 
                       Padding="20" 
                       Margin="0,20,0,0">
                    <VerticalStackLayout Spacing="10" HorizontalOptions="Center">
                        <Label Text="ðŸ”’" 
                               FontSize="48" 
                               HorizontalOptions="Center" />
                        <Label Text="Please Sign In" 
                               FontSize="20" 
                               FontAttributes="Bold" 
                               HorizontalOptions="Center" 
                               TextColor="#2C3E50" />
                        <Label Text="Create an account or sign in to browse our collection of spare parts from trusted shops." 
                               FontSize="14" 
                               HorizontalOptions="Center" 
                               HorizontalTextAlignment="Center"
                               TextColor="Gray" 
                               LineBreakMode="WordWrap" />
                    </VerticalStackLayout>
                </Frame>
            </StackLayout>
            
            <!-- User Info Section - Show when authenticated -->
            <StackLayout x:Name="UserInfoSection" IsVisible="False">
                <Frame BackgroundColor="#3498DB" 
                       CornerRadius="10" 
                       Padding="15" 
                       Margin="0,0,0,10">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        
                        <VerticalStackLayout Grid.Column="0">
                            <Label x:Name="WelcomeLabel"
                                   Text="Welcome back!" 
                                   FontSize="18" 
                                   FontAttributes="Bold" 
                                   TextColor="White" />
                            <Label x:Name="EmailLabel"
                                   Text="" 
                                   FontSize="14" 
                                   TextColor="LightBlue" />
                        </VerticalStackLayout>
                        
                        <Button Grid.Column="1" 
                                Text="Logout" 
                                BackgroundColor="#E74C3C" 
                                TextColor="White" 
                                CornerRadius="5" 
                                HeightRequest="35" 
                                WidthRequest="70" 
                                FontSize="12"
                                x:Name="LogoutButton" />
                    </Grid>
                </Frame>
            </StackLayout>
            
            <!-- Shops Section - Show when authenticated -->
            <StackLayout x:Name="ShopsSection" IsVisible="False">
                <Label Text="Available Shops" 
                       FontSize="20" 
                       FontAttributes="Bold" 
                       TextColor="#2C3E50" 
                       Margin="0,0,0,15" />
                
                <CollectionView x:Name="ShopsCollection">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid Padding="10">
                            <Frame BackgroundColor="White" 
                                   HasShadow="True" 
                                   CornerRadius="12" 
                                   Padding="0">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    
                                    <!-- Shop Header -->
                                    <Grid Grid.Row="0" 
                                          BackgroundColor="#3498DB" 
                                          Padding="15">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        
                                        <Frame Grid.Column="0" 
                                               BackgroundColor="White" 
                                               CornerRadius="20" 
                                               WidthRequest="40" 
                                               HeightRequest="40" 
                                               Padding="0">
                                            <Image Source="shop_icon.png" 
                                                   WidthRequest="30" 
                                                   HeightRequest="30" />
                                        </Frame>
                                        
                                        <VerticalStackLayout Grid.Column="1" 
                                                             Margin="10,0,0,0">
                                            <Label Text="{Binding Name}" 
                                                   FontSize="18" 
                                                   FontAttributes="Bold" 
                                                   TextColor="White" />
                                            <Label Text="{Binding Address}" 
                                                   FontSize="12" 
                                                   TextColor="LightBlue" />
                                        </VerticalStackLayout>
                                        
                                        <Label Grid.Column="2" 
                                               Text="{Binding IsActive, Converter={StaticResource BoolToStatusConverter}}" 
                                               FontSize="12" 
                                               TextColor="LightGreen" 
                                               VerticalOptions="Center" />
                                    </Grid>
                                    
                                    <!-- Shop Description -->
                                    <Label Grid.Row="1" 
                                           Text="{Binding Description}" 
                                           FontSize="14" 
                                           TextColor="Gray" 
                                           Padding="15,10,15,5" />
                                    
                                    <!-- Shop Stats -->
                                    <Grid Grid.Row="2" 
                                          Padding="15,0,15,10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        
                                        <VerticalStackLayout Grid.Column="0" 
                                                             HorizontalOptions="Center">
                                            <Label Text="{Binding ProductCount}" 
                                                   FontSize="16" 
                                                   FontAttributes="Bold" 
                                                   TextColor="#2C3E50" 
                                                   HorizontalOptions="Center" />
                                            <Label Text="Products" 
                                                   FontSize="12" 
                                                   TextColor="Gray" 
                                                   HorizontalOptions="Center" />
                                        </VerticalStackLayout>
                                        
                                        <VerticalStackLayout Grid.Column="1" 
                                                             HorizontalOptions="Center">
                                            <Label Text="{Binding Rating}" 
                                                   FontSize="16" 
                                                   FontAttributes="Bold" 
                                                   TextColor="#F39C12" 
                                                   HorizontalOptions="Center" />
                                            <Label Text="Rating" 
                                                   FontSize="12" 
                                                   TextColor="Gray" 
                                                   HorizontalOptions="Center" />
                                        </VerticalStackLayout>
                                        
                                        <VerticalStackLayout Grid.Column="2" 
                                                             HorizontalOptions="Center">
                                            <Label Text="{Binding Distance}" 
                                                   FontSize="16" 
                                                   FontAttributes="Bold" 
                                                   TextColor="#27AE60" 
                                                   HorizontalOptions="Center" />
                                            <Label Text="km away" 
                                                   FontSize="12" 
                                                   TextColor="Gray" 
                                                   HorizontalOptions="Center" />
                                        </VerticalStackLayout>
                                    </Grid>
                                    
                                    <!-- Featured Products Preview -->
                                    <Frame Grid.Row="3" 
                                           BackgroundColor="#F8F9FA" 
                                           CornerRadius="0,0,12,12" 
                                           Padding="15,10">
                                        <VerticalStackLayout>
                                            <Label Text="Featured Products:" 
                                                   FontSize="12" 
                                                   FontAttributes="Bold" 
                                                   TextColor="#2C3E50" 
                                                   Margin="0,0,0,5" />
                                            
                                            <CollectionView ItemsSource="{Binding FeaturedProducts}" 
                                                            HeightRequest="60">
                                                <CollectionView.ItemsLayout>
                                                    <LinearItemsLayout Orientation="Horizontal" 
                                                                       ItemSpacing="10" />
                                                </CollectionView.ItemsLayout>
                                                <CollectionView.ItemTemplate>
                                                    <DataTemplate>
                                                        <Frame BackgroundColor="White" 
                                                               CornerRadius="8" 
                                                               Padding="8" 
                                                               WidthRequest="80">
                                                            <VerticalStackLayout>
                                                                <Label Text="{Binding Name}" 
                                                                       FontSize="10" 
                                                                       FontAttributes="Bold" 
                                                                       TextColor="#2C3E50" 
                                                                       LineBreakMode="TailTruncation" />
                                                                <Label Text="{Binding Price, StringFormat='${0:F0}'}" 
                                                                       FontSize="10" 
                                                                       TextColor="#27AE60" 
                                                                       FontAttributes="Bold" />
                                                            </VerticalStackLayout>
                                                        </Frame>
                                                    </DataTemplate>
                                                </CollectionView.ItemTemplate>
                                            </CollectionView>
                                        </VerticalStackLayout>
                                    </Frame>
                                    
                                    <!-- Action Buttons -->
                                    <Grid Grid.Row="4" 
                                          Padding="15,10,15,15">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        
                                        <Button Grid.Column="0" 
                                                Text="View Shop" 
                                                BackgroundColor="#3498DB" 
                                                TextColor="White" 
                                                CornerRadius="8" 
                                                HeightRequest="40" 
                                                FontSize="14"
                                                FontAttributes="Bold"
                                                Margin="0,0,5,0"
                                                Clicked="OnViewShopClicked" />
                                        
                                        <Button Grid.Column="1" 
                                                Text="Contact" 
                                                BackgroundColor="#27AE60" 
                                                TextColor="White" 
                                                CornerRadius="8" 
                                                HeightRequest="40" 
                                                FontSize="14"
                                                FontAttributes="Bold"
                                                Margin="5,0,0,0"
                                                Clicked="OnContactShopClicked" />
                                    </Grid>
                                </Grid>
                            </Frame>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
            </StackLayout>
        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
